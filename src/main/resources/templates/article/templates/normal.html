<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>文章</title>
    <meta name="renderer" content="webkit">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" th:href="@{/css/common.css}">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Mono&display=swap">
    <link rel="stylesheet" href="/ckeditor-v4.12.1/plugins/codesnippet/lib/highlight/styles/vue.css?t=20191020">
    <script src="/ckeditor-v4.12.1/plugins/codesnippet/lib/highlight/highlight.pack.js"></script>
    <style>
        h1 {
            position: relative;
        }

        ul {
            margin: 0;
            padding: 0;
        }

        li {
            list-style: none;
        }

        .directory ul {
            line-height: 26px;
        }

        .directory li {
            position: relative;
        }

        .directory a {
            display: block;
            color: #304455;
            line-height: 26px;
            text-decoration: none;
        }

        .directory a:hover {
            color: rgba(56, 103, 214, 1);
        }

        .directory a.active {
            background: rgba(56, 103, 214, .12);
        }

        .directory.none {
            display: none;
        }

        .level1 {margin-left: 15px;}
        .level1:after {position: absolute;content: '#';top: 0;left: -15px;}
        .level2 {margin-left: 30px;}
        .level2:after {position: absolute;content: '';top: 11px;left: -15px;width: 4px;height: 4px;border-radius: 50%;background: #304455;}
        .level3 {margin-left: 45px;}
        .level3:after {position: absolute;content: '';top: 11px;left: -15px;width: 4px;height: 4px;background: #304455;}
        .level4 {margin-left: 45px;}
        .level4:after {position: absolute;content: '';top: 11px;left: -15px;width: 4px;height: 4px;background: #304455;}
        .level5 {margin-left: 60px;}
        .level5:after {position: absolute;content: '';top: 11px;left: -15px;width: 4px;height: 4px;background: #304455;}
        .level6 {margin-left: 75px;}
        .level6:after {position: absolute;content: '';top: 11px;left: -15px;width: 4px;height: 4px;background: #304455;}

        .main {
            width: 946px;
            padding: 0;
            margin: 24px auto 0 auto;
        }

        .clear:after {
            content: '\0020';
            display: block;
            height: 0;
            clear: both;
            visibility: hidden;
        }

        .left-side {
            width: 656px;
            float: left;
            padding: 0 24px;
        }

        .right-side {
            width: 280px;
            float: right;
        }

        .right-side-copy {
            display: none;
        }

        .md-ripple-container {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-clip: padding-box;
            pointer-events: none;
        }

        .md-ripple-container svg {
            position: absolute;
            fill: rgba(56, 103, 214, .12);
            -webkit-transition: all .4s cubic-bezier(0.25, 0.8, 0.25, 1);
            transition: all .4s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        @media screen and (max-width: 960px) {
            .main {
                width: 100%;
            }

            .left-side {
                float: none;
                margin: 0 auto;
            }

            .right-side {
                display: none;
            }

            .right-side-copy {
                display: block;
            }
        }

        @media screen and (max-width: 670px) {
            .left-side {
                width: 100%;
            }
        }
    </style>
</head>
<body>
<div class="header">
    <ul class="header-menu">
        <li th:if="${user != null}" class="header-item">
            <button class="menu-button"><span>Menu</span></button>
        </li>
        <li th:if="${user == null}" class="header-item dropdown-content">
            <button class="login-button dropdown-trigger"><i class="iconfont">&#xe622;</i></button>
            <div class="dropdown hidden">
                <ul class="dropdown-menu">
                    <li id="login" class="dropdown-item">登录</li>
                    <li  class="dropdown-item">注册</li>
                </ul>
            </div>
        </li>
    </ul>
</div>
<div class="header-space"></div>
<div class="sidebar">
    <div class="sidebar-inner">
        <div class="right-side-copy">
            <div>Article-2</div>
            <div class="directory none"><h3 style="margin-top: 0;">目录</h3></div>
        </div>
    </div>
</div>
<div class="main clear">
    <div class="left-side">
        <div class="article" id="article" th:utext="${article.content}"></div>
    </div>
    <div class="right-side">
        <div>Article-2</div>
        <div class="directory none sticky" data-sticky-top="24" data-width="280"><h3 style="margin-top: 0;">目录</h3></div>
    </div>
</div>
<script>hljs.initHighlightingOnLoad();</script>
<script src="https://cdn.bootcss.com/jquery/3.4.0/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/fastclick/1.0.6/fastclick.js"></script>
<script th:src="@{/js/common.js}"></script>
<script th:src="@{/js/md-ripple.js}"></script>
<script>
    var $directory = $('.directory'),dirString = '', num = 0;
    $("#article").children().each(function () {
        var $this = $(this);
        var tagName = $this[0].tagName;

        if (tagName.substr(0,1) === 'H') {
            var contentH = $this.text().replace(/\s*/g, '');
            contentH = contentH.replace(/\./g, '-');
            var level = tagName.substr(1,1);
            var hID = num + '-' + contentH;
            $this.attr('id', hID);
            hID = '##' + hID;

            dirString += '<li class="level' + level + '"><a href="' + hID + '">' + contentH + '</a></li>';
            num += 1;
        }
    });
    dirString = '<ul>' + dirString + '</ul>';
    if (num > 0) {
        $directory.append(dirString);
        $directory.removeClass('none');
        $('.directory a').mdRipple();
    }

    var page = $('html, body');

    function pageTo (href) {
        var target;
        var pattern = /##.+/;
        if (href === '#') {
            target = 0;
        } else if (pattern.test(href)) {
            var len = href.length, hash = href.lastIndexOf("#");
            var id = href.substr(hash, len - hash);
            var ele = $(id);
            if (ele.length === 0) return;
            target = ele.offset().top - 60;
        } else {
            return;
        }
        var limit = $(document).height() - $(window).height();
        if (target > limit) {
            target = limit;
        }
        page.on('scroll mousedown wheel DOMMouseScroll mousewheel keyup touchmove', function () {
            page.stop();
        });
        page.animate({scrollTop: target}, 600, function () {
            page.off('scroll mousedown wheel DOMMouseScroll mousewheel keyup touchmove');
        });
    }

    $('a[href*="#"]').mousedown(function () {
        $('.directory a').removeClass('active');
        $(this).addClass('active');
        return false;
    });

    $('a[href*="#"]').click(function () {
        var href = $(this).attr('href');
        window.location.hash = href;
        pageTo(href);
        return false;
    });

    var $sticky = $('.sticky'), stickyInitFlag = false, scrollTop;

    function stickyInit() {
        if (!stickyInitFlag) {
            if ($(window).width() > 960) {
                $sticky.data('offsetTop', $sticky.offset().top);
                scrollEvent();
                stickyInitFlag = true;
            } else {
                $sticky.data('offsetTop', 10000);
            }
        }
    }
    stickyInit();

    function scrollEvent () {
        scrollTop = $(this).scrollTop();
        $sticky.each(function () {
            var $this = $(this);
            var top = $this.data('stickyTop');
            if (scrollTop + 60 + top > $this.data('offsetTop')) {
                $this.css({'position': 'fixed', 'top': 60 + top, 'width': $sticky.data('width')});
            } else {
                $this.css({'position': '', 'top': '', 'width': ''});
            }
        })
    }

    $(window).resize(stickyInit);
    $(document).scroll(scrollEvent);
    $(document).ready(function () {pageTo(decodeURIComponent(window.location.hash));});
</script>
</body>
</html>