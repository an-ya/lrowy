<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>文章</title>
    <meta name="renderer" content="webkit">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" th:href="@{/css/common.css}">
    <link rel="stylesheet" th:href="@{/css/article.css}">
    <link rel="stylesheet" th:href="@{/css/comment.css}">
    <link rel="stylesheet" th:href="@{/css/tool.css}">
    <link rel="stylesheet" th:href="@{/css/vue.css}">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=ZCOOL+XiaoWei&display=swap&subset=chinese-simplified">
    <script th:src="@{/js/highlight.pack.js}"></script>
    <script src="//at.alicdn.com/t/font_1286797_bzbcblwzlg.js"></script>
</head>
<body>
<div class="header"><span class="logo custom-font1">Anya</span><ul class="header-menu"></ul></div>
<div class="header-space"></div>
<div class="sidebar">
    <div class="sidebar-inner">
        <div class="right-side-copy">
            <div class="panel">
                <a class="btn-item" href="/index" target="_blank">
                    <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
                        <path class="mark" d="M756.8 976H475.2c-86.4 0-155.2-70.4-155.2-155.2v-46.4c0-86.4 70.4-155.2 155.2-155.2h281.6c86.4 0 155.2 70.4 155.2 155.2v46.4c0 84.8-70.4 155.2-155.2 155.2z" fill="#96E8BA"></path>
                        <path d="M838.4 451.2H147.2c-20.8 0-36.8-11.2-44.8-30.4s-3.2-38.4 11.2-52.8l124.8-110.4c6.4-6.4 17.6-4.8 24 1.6 6.4 6.4 4.8 17.6-1.6 24l-124.8 110.4c-6.4 6.4-3.2 14.4-3.2 16s4.8 9.6 14.4 9.6h692.8c9.6 0 14.4-8 14.4-9.6 1.6-1.6 3.2-9.6-3.2-17.6l-345.6-304c-8-8-17.6-6.4-24 0l-107.2 94.4c-6.4 6.4-17.6 4.8-24-1.6-6.4-6.4-4.8-17.6 1.6-24l105.6-94.4c9.6-9.6 22.4-14.4 35.2-14.4 12.8 0 25.6 4.8 35.2 14.4l345.6 304c14.4 14.4 19.2 35.2 11.2 54.4-8 17.6-25.6 30.4-46.4 30.4z" fill="#103E26"></path>
                        <path d="M283.2 254.4c-4.8 0-9.6-1.6-12.8-4.8-6.4-6.4-4.8-17.6 1.6-24l43.2-38.4c6.4-6.4 17.6-4.8 24 1.6 6.4 6.4 4.8 17.6-1.6 24l-43.2 38.4c-3.2 1.6-6.4 3.2-11.2 3.2zM812.8 896h-224c-9.6 0-16-8-16-16V704h-158.4v176c0 9.6-8 16-16 16h-224c-9.6 0-16-8-16-16V480c0-9.6 8-16 16-16s16 8 16 16v384h190.4V688c0-9.6 8-16 16-16h192c9.6 0 16 8 16 16v176h190.4V480c0-9.6 8-16 16-16s16 8 16 16v400c1.6 9.6-4.8 16-14.4 16z" fill="#103E26"></path>
                        <path d="M592 592H400c-9.6 0-16-8-16-16s8-16 16-16h192c9.6 0 16 8 16 16s-6.4 16-16 16zM473.6 267.2c-4.8 0-11.2-3.2-12.8-8-4.8-8-1.6-17.6 4.8-20.8l54.4-32-54.4-38.4c-6.4-4.8-8-14.4-3.2-22.4 4.8-6.4 14.4-8 22.4-3.2l75.2 52.8c4.8 3.2 6.4 8 6.4 12.8s-3.2 9.6-8 12.8l-75.2 44.8c-3.2 1.6-6.4 1.6-9.6 1.6z" fill="#103E26"></path>
                    </svg>
                    <span>首页</span>
                </a>
                <a class="btn-item" th:href="${'/writer#/' + article.articleId}" target="_self">
                    <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
                        <path class="mark" d="M772.8 928H491.2c-86.4 0-155.2-70.4-155.2-155.2v-46.4c0-86.4 70.4-155.2 155.2-155.2h281.6c86.4 0 155.2 70.4 155.2 155.2v46.4c0 84.8-70.4 155.2-155.2 155.2z" fill="#96E8BA"></path>
                        <path d="M720 851.2H272c-62.4 0-113.6-46.4-113.6-104V241.6c0-57.6 51.2-104 113.6-104h235.2c12.8 0 22.4 9.6 22.4 22.4s-9.6 22.4-22.4 22.4H272c-38.4 0-68.8 27.2-68.8 59.2v504c0 32 30.4 59.2 68.8 59.2h448c38.4 0 68.8-27.2 68.8-59.2V326.4c0-12.8 9.6-22.4 22.4-22.4s22.4 9.6 22.4 22.4v419.2c0 57.6-51.2 105.6-113.6 105.6z" fill="#103E26"></path>
                        <path d="M526.4 376c-6.4 0-11.2-1.6-16-6.4-8-9.6-8-22.4 1.6-32L793.6 70.4c9.6-8 22.4-8 32 1.6 8 9.6 8 22.4-1.6 32L542.4 369.6c-4.8 4.8-9.6 6.4-16 6.4zM688 446.4H320c-12.8 0-22.4-9.6-22.4-22.4s9.6-22.4 22.4-22.4h368c12.8 0 22.4 9.6 22.4 22.4s-9.6 22.4-22.4 22.4zM688 574.4H320c-12.8 0-22.4-9.6-22.4-22.4s9.6-22.4 22.4-22.4h368c12.8 0 22.4 9.6 22.4 22.4s-9.6 22.4-22.4 22.4zM688 686.4H320c-12.8 0-22.4-9.6-22.4-22.4s9.6-22.4 22.4-22.4h368c12.8 0 22.4 9.6 22.4 22.4s-9.6 22.4-22.4 22.4z" fill="#103E26"></path>
                    </svg>
                    <span>编辑</span>
                </a>
                <div class="btn-item">
                    <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
                        <path class="mark" d="M820.8 944H539.2c-86.4 0-155.2-70.4-155.2-155.2v-46.4c0-86.4 70.4-155.2 155.2-155.2h281.6c86.4 0 155.2 70.4 155.2 155.2v46.4c0 84.8-70.4 155.2-155.2 155.2z" fill="#96E8BA"></path>
                        <path d="M304 465.6c-100.8 0-182.4-81.6-182.4-182.4S203.2 102.4 304 102.4s182.4 81.6 182.4 182.4S404.8 465.6 304 465.6z m0-320c-75.2 0-137.6 62.4-137.6 137.6s62.4 137.6 137.6 137.6 137.6-62.4 137.6-137.6-62.4-137.6-137.6-137.6zM768 462.4h-128c-65.6 0-118.4-52.8-118.4-118.4v-128c0-65.6 52.8-118.4 118.4-118.4h128c65.6 0 118.4 52.8 118.4 118.4v128c0 65.6-52.8 118.4-118.4 118.4z m-128-320c-40 0-73.6 33.6-73.6 73.6v128c0 40 33.6 73.6 73.6 73.6h128c40 0 73.6-33.6 73.6-73.6v-128c0-40-33.6-73.6-73.6-73.6h-128zM368 862.4h-128c-65.6 0-118.4-52.8-118.4-118.4v-128c0-65.6 52.8-118.4 118.4-118.4h128c65.6 0 118.4 52.8 118.4 118.4v128c0 65.6-52.8 118.4-118.4 118.4z m-128-320c-40 0-73.6 33.6-73.6 73.6v128c0 40 33.6 73.6 73.6 73.6h128c40 0 73.6-33.6 73.6-73.6v-128c0-40-33.6-73.6-73.6-73.6h-128zM768 862.4h-128c-65.6 0-118.4-52.8-118.4-118.4v-128c0-65.6 52.8-118.4 118.4-118.4h128c65.6 0 118.4 52.8 118.4 118.4v128c0 65.6-52.8 118.4-118.4 118.4z m-128-320c-40 0-73.6 33.6-73.6 73.6v128c0 40 33.6 73.6 73.6 73.6h128c40 0 73.6-33.6 73.6-73.6v-128c0-40-33.6-73.6-73.6-73.6h-128z" fill="#103E26"></path>
                        <path d="M304 368c-46.4 0-83.2-38.4-83.2-83.2s38.4-83.2 83.2-83.2 83.2 38.4 83.2 83.2S350.4 368 304 368z m0-128c-24 0-44.8 19.2-44.8 44.8s19.2 44.8 44.8 44.8 44.8-19.2 44.8-44.8S328 240 304 240z" fill="#103E26"></path>
                    </svg>
                    <span>更多</span>
                </div>
                <div class="btn-item">
                    <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
                        <path class="mark" d="M772.8 880H491.2c-86.4 0-155.2-70.4-155.2-155.2v-46.4c0-86.4 70.4-155.2 155.2-155.2h281.6c86.4 0 155.2 70.4 155.2 155.2v46.4c0 84.8-70.4 155.2-155.2 155.2z" fill="#96E8BA"></path>
                        <path d="M480 628.8c-4.8 0-8-1.6-12.8-3.2L116.8 387.2c-6.4-4.8-9.6-11.2-9.6-19.2s3.2-14.4 9.6-19.2l134.4-91.2c9.6-6.4 24-4.8 30.4 6.4 6.4 9.6 4.8 24-6.4 30.4L169.6 368 480 579.2l128-88 33.6-121.6c1.6-6.4 8-12.8 14.4-14.4 6.4-3.2 14.4-1.6 20.8 3.2l64 44.8 51.2-35.2L480 156.8l-56 38.4c-9.6 6.4-24 4.8-30.4-6.4-6.4-9.6-4.8-24 6.4-30.4L468.8 112c8-4.8 17.6-4.8 25.6 0l350.4 238.4c6.4 4.8 9.6 11.2 9.6 19.2s-3.2 14.4-9.6 19.2L752 448c-8 4.8-17.6 4.8-25.6 0l-49.6-35.2-27.2 99.2c-1.6 4.8-4.8 9.6-9.6 12.8l-147.2 100.8c-3.2 1.6-8 3.2-12.8 3.2z" fill="#103E26"></path>
                        <path d="M313.6 264c-6.4 0-14.4-3.2-19.2-9.6-6.4-9.6-4.8-24 6.4-30.4l44.8-30.4c9.6-6.4 24-4.8 30.4 6.4s4.8 24-6.4 30.4l-44.8 30.4c-1.6 3.2-6.4 3.2-11.2 3.2zM480 740.8c-4.8 0-8-1.6-12.8-3.2L116.8 499.2c-9.6-6.4-12.8-20.8-6.4-30.4 6.4-9.6 20.8-12.8 30.4-6.4L480 691.2l337.6-230.4c9.6-6.4 24-4.8 30.4 6.4 6.4 9.6 4.8 24-6.4 30.4l-348.8 240c-3.2 1.6-8 3.2-12.8 3.2z" fill="#103E26"></path>
                        <path d="M480 852.8c-4.8 0-8-1.6-12.8-3.2L116.8 611.2c-9.6-6.4-12.8-20.8-6.4-30.4 6.4-9.6 20.8-12.8 30.4-6.4L480 803.2l337.6-230.4c9.6-6.4 24-4.8 30.4 6.4 6.4 9.6 4.8 24-6.4 30.4l-348.8 240c-3.2 1.6-8 3.2-12.8 3.2z" fill="#103E26"></path>
                    </svg>
                    <span>分类</span>
                </div>
            </div>
            <div class="about">
                <div class="name">黯伢</div>
                <div class="desc">程序员</div>
            </div>
            <div class="sticky">
                <div class="directory"></div>
                <a class="to-top" href="javascript:void(0);" title="回到顶部" onclick="pageTo('#')">
                    <svg class="icon" aria-hidden="true">
                        <use xlink:href="#iconyoujiantou-copy"></use>
                    </svg>
                </a>
            </div>
        </div>
    </div>
</div>
<div class="main clear">
    <div class="left-side">
        <div class="article-info">
            <div class="t">
                <a th:href="${'/article/' + article.articleId}" th:text="${article.title}"></a>
                <i class="iconfont copy" title="复制链接" th:attr="data-article-id=${article.articleId}" onclick="copyLink(this)">&#xe745;</i>
            </div>
            <div class="detail">
                <span th:each="tag : ${article.tags}" class="tag" th:text="${tag.name}"></span>
                <span th:if="${article.description != null && article.description != ''}" class="desc line1" th:text="${article.description}"></span>
            </div>
        </div>
        <div class="article-wrapper">
            <div class="article" id="article" th:utext="${article.content}" th:attr="data-article-id=${article.articleId}"></div>
        </div>
        <div class="comment-container">
            <div class="comment-title">评论</div>
            <div class="comment-list">
                <div class="comment" th:each="c : ${comments}" th:id="${c.commentId}">
                    <img class="comment-avatar" th:src="${c.avatar}" alt=""/>
                    <div class="comment-nickname">
                        <span class="owner" th:text="${c.name}"></span>
                    </div>
                    <div class="comment-content" th:utext="${c.content}"></div>
                    <div class="comment-info">
                        <a class="comment-reply-btn" href="javascript:void(0);" th:attr="onclick=${user == null ? 'loginTip()' : 'setComment(this)'}"><i class="iconfont">&#xe635;</i>回复</a>
                        <span class="comment-time" th:text="${#dates.format(c.createDate, 'yyyy.MM.dd')}"></span>
                    </div>
                    <div class="comment-reply" th:if="${c.child != null}">
                        <div class="comment" th:each="r : ${c.child}" th:id="${r.commentId}">
                            <img class="comment-avatar" th:src="${r.avatar}" alt=""/>
                            <div class="comment-nickname">
                                <span class="owner" th:text="${r.name}"></span>
                                <span th:if="${r.fold}" class="comment-reply-text">回复</span>
                                <span th:if="${r.fold}" th:text="${r.pName}"></span>
                            </div>
                            <div class="comment-content" th:utext="${r.content}"></div>
                            <div class="comment-info">
                                <a class="comment-reply-btn" href="javascript:void(0);" th:attr="onclick=${user == null ? 'loginTip()' : 'setComment(this)'}"><i class="iconfont">&#xe635;</i>回复</a>
                                <span class="comment-time" th:text="${#dates.format(r.createDate, 'yyyy.MM.dd')}"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="editor-container" id="editor-container">
                <div th:if="${user == null}" class="tip middle"><span>请先<a href="javascript:void(0);" onclick="loginTip()">登录</a></span></div>
                <textarea id="editor"  style="height:200px;" placeholder="从这里开始写正文"></textarea>
            </div>
            <div th:if="${user != null}" class="comment-submit-btn" onclick="submitComment()">发表</div>
        </div>
    </div>
    <div class="right-side">
        <div class="panel">
            <a class="btn-item" href="/index" target="_blank">
                <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <path class="mark" d="M756.8 976H475.2c-86.4 0-155.2-70.4-155.2-155.2v-46.4c0-86.4 70.4-155.2 155.2-155.2h281.6c86.4 0 155.2 70.4 155.2 155.2v46.4c0 84.8-70.4 155.2-155.2 155.2z" fill="#96E8BA"></path>
                    <path d="M838.4 451.2H147.2c-20.8 0-36.8-11.2-44.8-30.4s-3.2-38.4 11.2-52.8l124.8-110.4c6.4-6.4 17.6-4.8 24 1.6 6.4 6.4 4.8 17.6-1.6 24l-124.8 110.4c-6.4 6.4-3.2 14.4-3.2 16s4.8 9.6 14.4 9.6h692.8c9.6 0 14.4-8 14.4-9.6 1.6-1.6 3.2-9.6-3.2-17.6l-345.6-304c-8-8-17.6-6.4-24 0l-107.2 94.4c-6.4 6.4-17.6 4.8-24-1.6-6.4-6.4-4.8-17.6 1.6-24l105.6-94.4c9.6-9.6 22.4-14.4 35.2-14.4 12.8 0 25.6 4.8 35.2 14.4l345.6 304c14.4 14.4 19.2 35.2 11.2 54.4-8 17.6-25.6 30.4-46.4 30.4z" fill="#103E26"></path>
                    <path d="M283.2 254.4c-4.8 0-9.6-1.6-12.8-4.8-6.4-6.4-4.8-17.6 1.6-24l43.2-38.4c6.4-6.4 17.6-4.8 24 1.6 6.4 6.4 4.8 17.6-1.6 24l-43.2 38.4c-3.2 1.6-6.4 3.2-11.2 3.2zM812.8 896h-224c-9.6 0-16-8-16-16V704h-158.4v176c0 9.6-8 16-16 16h-224c-9.6 0-16-8-16-16V480c0-9.6 8-16 16-16s16 8 16 16v384h190.4V688c0-9.6 8-16 16-16h192c9.6 0 16 8 16 16v176h190.4V480c0-9.6 8-16 16-16s16 8 16 16v400c1.6 9.6-4.8 16-14.4 16z" fill="#103E26"></path>
                    <path d="M592 592H400c-9.6 0-16-8-16-16s8-16 16-16h192c9.6 0 16 8 16 16s-6.4 16-16 16zM473.6 267.2c-4.8 0-11.2-3.2-12.8-8-4.8-8-1.6-17.6 4.8-20.8l54.4-32-54.4-38.4c-6.4-4.8-8-14.4-3.2-22.4 4.8-6.4 14.4-8 22.4-3.2l75.2 52.8c4.8 3.2 6.4 8 6.4 12.8s-3.2 9.6-8 12.8l-75.2 44.8c-3.2 1.6-6.4 1.6-9.6 1.6z" fill="#103E26"></path>
                </svg>
                <span>首页</span>
            </a>
            <a class="btn-item" th:href="${'/writer#/' + article.articleId}" target="_self">
                <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <path class="mark" d="M772.8 928H491.2c-86.4 0-155.2-70.4-155.2-155.2v-46.4c0-86.4 70.4-155.2 155.2-155.2h281.6c86.4 0 155.2 70.4 155.2 155.2v46.4c0 84.8-70.4 155.2-155.2 155.2z" fill="#96E8BA"></path>
                    <path d="M720 851.2H272c-62.4 0-113.6-46.4-113.6-104V241.6c0-57.6 51.2-104 113.6-104h235.2c12.8 0 22.4 9.6 22.4 22.4s-9.6 22.4-22.4 22.4H272c-38.4 0-68.8 27.2-68.8 59.2v504c0 32 30.4 59.2 68.8 59.2h448c38.4 0 68.8-27.2 68.8-59.2V326.4c0-12.8 9.6-22.4 22.4-22.4s22.4 9.6 22.4 22.4v419.2c0 57.6-51.2 105.6-113.6 105.6z" fill="#103E26"></path>
                    <path d="M526.4 376c-6.4 0-11.2-1.6-16-6.4-8-9.6-8-22.4 1.6-32L793.6 70.4c9.6-8 22.4-8 32 1.6 8 9.6 8 22.4-1.6 32L542.4 369.6c-4.8 4.8-9.6 6.4-16 6.4zM688 446.4H320c-12.8 0-22.4-9.6-22.4-22.4s9.6-22.4 22.4-22.4h368c12.8 0 22.4 9.6 22.4 22.4s-9.6 22.4-22.4 22.4zM688 574.4H320c-12.8 0-22.4-9.6-22.4-22.4s9.6-22.4 22.4-22.4h368c12.8 0 22.4 9.6 22.4 22.4s-9.6 22.4-22.4 22.4zM688 686.4H320c-12.8 0-22.4-9.6-22.4-22.4s9.6-22.4 22.4-22.4h368c12.8 0 22.4 9.6 22.4 22.4s-9.6 22.4-22.4 22.4z" fill="#103E26"></path>
                </svg>
                <span>编辑</span>
            </a>
            <div class="btn-item">
                <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <path class="mark" d="M820.8 944H539.2c-86.4 0-155.2-70.4-155.2-155.2v-46.4c0-86.4 70.4-155.2 155.2-155.2h281.6c86.4 0 155.2 70.4 155.2 155.2v46.4c0 84.8-70.4 155.2-155.2 155.2z" fill="#96E8BA"></path>
                    <path d="M304 465.6c-100.8 0-182.4-81.6-182.4-182.4S203.2 102.4 304 102.4s182.4 81.6 182.4 182.4S404.8 465.6 304 465.6z m0-320c-75.2 0-137.6 62.4-137.6 137.6s62.4 137.6 137.6 137.6 137.6-62.4 137.6-137.6-62.4-137.6-137.6-137.6zM768 462.4h-128c-65.6 0-118.4-52.8-118.4-118.4v-128c0-65.6 52.8-118.4 118.4-118.4h128c65.6 0 118.4 52.8 118.4 118.4v128c0 65.6-52.8 118.4-118.4 118.4z m-128-320c-40 0-73.6 33.6-73.6 73.6v128c0 40 33.6 73.6 73.6 73.6h128c40 0 73.6-33.6 73.6-73.6v-128c0-40-33.6-73.6-73.6-73.6h-128zM368 862.4h-128c-65.6 0-118.4-52.8-118.4-118.4v-128c0-65.6 52.8-118.4 118.4-118.4h128c65.6 0 118.4 52.8 118.4 118.4v128c0 65.6-52.8 118.4-118.4 118.4z m-128-320c-40 0-73.6 33.6-73.6 73.6v128c0 40 33.6 73.6 73.6 73.6h128c40 0 73.6-33.6 73.6-73.6v-128c0-40-33.6-73.6-73.6-73.6h-128zM768 862.4h-128c-65.6 0-118.4-52.8-118.4-118.4v-128c0-65.6 52.8-118.4 118.4-118.4h128c65.6 0 118.4 52.8 118.4 118.4v128c0 65.6-52.8 118.4-118.4 118.4z m-128-320c-40 0-73.6 33.6-73.6 73.6v128c0 40 33.6 73.6 73.6 73.6h128c40 0 73.6-33.6 73.6-73.6v-128c0-40-33.6-73.6-73.6-73.6h-128z" fill="#103E26"></path>
                    <path d="M304 368c-46.4 0-83.2-38.4-83.2-83.2s38.4-83.2 83.2-83.2 83.2 38.4 83.2 83.2S350.4 368 304 368z m0-128c-24 0-44.8 19.2-44.8 44.8s19.2 44.8 44.8 44.8 44.8-19.2 44.8-44.8S328 240 304 240z" fill="#103E26"></path>
                </svg>
                <span>更多</span>
            </div>
            <div class="btn-item">
                <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <path class="mark" d="M772.8 880H491.2c-86.4 0-155.2-70.4-155.2-155.2v-46.4c0-86.4 70.4-155.2 155.2-155.2h281.6c86.4 0 155.2 70.4 155.2 155.2v46.4c0 84.8-70.4 155.2-155.2 155.2z" fill="#96E8BA"></path>
                    <path d="M480 628.8c-4.8 0-8-1.6-12.8-3.2L116.8 387.2c-6.4-4.8-9.6-11.2-9.6-19.2s3.2-14.4 9.6-19.2l134.4-91.2c9.6-6.4 24-4.8 30.4 6.4 6.4 9.6 4.8 24-6.4 30.4L169.6 368 480 579.2l128-88 33.6-121.6c1.6-6.4 8-12.8 14.4-14.4 6.4-3.2 14.4-1.6 20.8 3.2l64 44.8 51.2-35.2L480 156.8l-56 38.4c-9.6 6.4-24 4.8-30.4-6.4-6.4-9.6-4.8-24 6.4-30.4L468.8 112c8-4.8 17.6-4.8 25.6 0l350.4 238.4c6.4 4.8 9.6 11.2 9.6 19.2s-3.2 14.4-9.6 19.2L752 448c-8 4.8-17.6 4.8-25.6 0l-49.6-35.2-27.2 99.2c-1.6 4.8-4.8 9.6-9.6 12.8l-147.2 100.8c-3.2 1.6-8 3.2-12.8 3.2z" fill="#103E26"></path>
                    <path d="M313.6 264c-6.4 0-14.4-3.2-19.2-9.6-6.4-9.6-4.8-24 6.4-30.4l44.8-30.4c9.6-6.4 24-4.8 30.4 6.4s4.8 24-6.4 30.4l-44.8 30.4c-1.6 3.2-6.4 3.2-11.2 3.2zM480 740.8c-4.8 0-8-1.6-12.8-3.2L116.8 499.2c-9.6-6.4-12.8-20.8-6.4-30.4 6.4-9.6 20.8-12.8 30.4-6.4L480 691.2l337.6-230.4c9.6-6.4 24-4.8 30.4 6.4 6.4 9.6 4.8 24-6.4 30.4l-348.8 240c-3.2 1.6-8 3.2-12.8 3.2z" fill="#103E26"></path>
                    <path d="M480 852.8c-4.8 0-8-1.6-12.8-3.2L116.8 611.2c-9.6-6.4-12.8-20.8-6.4-30.4 6.4-9.6 20.8-12.8 30.4-6.4L480 803.2l337.6-230.4c9.6-6.4 24-4.8 30.4 6.4 6.4 9.6 4.8 24-6.4 30.4l-348.8 240c-3.2 1.6-8 3.2-12.8 3.2z" fill="#103E26"></path>
                </svg>
                <span>分类</span>
            </div>
            <a class="btn-item menu" href="javascript:void(0);">
                <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <path class="mark" d="M716.8 848C587.2 848 480 740.8 480 611.2c0-129.6 107.2-236.8 236.8-236.8 129.6 0 236.8 107.2 236.8 236.8C955.2 740.8 848 848 716.8 848z" fill="#96E8BA"></path>
                    <path d="M896 254.4H304c-12.8 0-22.4-9.6-22.4-22.4s9.6-22.4 22.4-22.4h592c12.8 0 22.4 9.6 22.4 22.4s-9.6 22.4-22.4 22.4zM768 520H304c-12.8 0-22.4-9.6-22.4-22.4s9.6-22.4 22.4-22.4h464c12.8 0 22.4 9.6 22.4 22.4s-9.6 22.4-22.4 22.4zM640 776H304c-12.8 0-22.4-9.6-22.4-22.4s9.6-22.4 22.4-22.4h336c12.8 0 22.4 9.6 22.4 22.4s-9.6 22.4-22.4 22.4zM155.2 321.6c-19.2 0-36.8-6.4-51.2-17.6-35.2-28.8-40-80-12.8-115.2 14.4-17.6 33.6-27.2 54.4-30.4 22.4-1.6 43.2 3.2 59.2 17.6 35.2 28.8 40 80 12.8 115.2-14.4 17.6-33.6 27.2-54.4 30.4h-8z m0-118.4h-4.8c-9.6 1.6-19.2 6.4-24 12.8-12.8 16-9.6 38.4 4.8 51.2 8 6.4 17.6 9.6 27.2 8 9.6-1.6 19.2-6.4 24-12.8 12.8-16 9.6-38.4-4.8-51.2-6.4-4.8-14.4-8-22.4-8zM155.2 833.6c-19.2 0-36.8-6.4-51.2-17.6-17.6-14.4-27.2-33.6-30.4-54.4-1.6-22.4 3.2-43.2 17.6-59.2 28.8-35.2 80-40 115.2-12.8 35.2 28.8 40 80 12.8 115.2-14.4 17.6-33.6 27.2-54.4 30.4-3.2-1.6-6.4-1.6-9.6-1.6z m0-118.4c-11.2 0-20.8 4.8-28.8 14.4-6.4 8-9.6 17.6-8 27.2 1.6 9.6 6.4 19.2 12.8 24s17.6 9.6 27.2 8c9.6-1.6 19.2-6.4 24-12.8 12.8-16 9.6-38.4-4.8-51.2-6.4-8-14.4-9.6-22.4-9.6zM155.2 577.6c-19.2 0-36.8-6.4-51.2-17.6-17.6-14.4-27.2-33.6-30.4-54.4-1.6-22.4 3.2-43.2 17.6-59.2 14.4-17.6 33.6-27.2 54.4-30.4 22.4-1.6 43.2 3.2 59.2 17.6 35.2 28.8 40 80 12.8 115.2-14.4 17.6-33.6 27.2-54.4 30.4-1.6-1.6-4.8-1.6-8-1.6z m0-118.4h-4.8c-9.6 1.6-19.2 6.4-24 12.8-6.4 8-9.6 17.6-8 27.2 1.6 9.6 6.4 19.2 12.8 24 8 6.4 17.6 9.6 27.2 8 9.6-1.6 19.2-6.4 24-12.8 12.8-16 9.6-38.4-4.8-51.2-6.4-4.8-14.4-8-22.4-8z" fill="#103E26"></path>
                </svg>
                <span>菜单</span>
            </a>
        </div>
        <div class="about">
            <div class="name">黯伢</div>
            <div class="desc">程序员</div>
        </div>
        <div class="sticky">
            <div class="directory"></div>
            <a class="to-top" href="javascript:void(0);" title="回到顶部" onclick="pageTo('#')">
                <svg class="icon" aria-hidden="true">
                    <use xlink:href="#iconyoujiantou-copy"></use>
                </svg>
            </a>
        </div>
    </div>
    <div class="float-side">
        <a class="btn-item menu" href="javascript:void(0);">
            <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
                <path class="mark" d="M716.8 848C587.2 848 480 740.8 480 611.2c0-129.6 107.2-236.8 236.8-236.8 129.6 0 236.8 107.2 236.8 236.8C955.2 740.8 848 848 716.8 848z" fill="#96E8BA"></path>
                <path d="M896 254.4H304c-12.8 0-22.4-9.6-22.4-22.4s9.6-22.4 22.4-22.4h592c12.8 0 22.4 9.6 22.4 22.4s-9.6 22.4-22.4 22.4zM768 520H304c-12.8 0-22.4-9.6-22.4-22.4s9.6-22.4 22.4-22.4h464c12.8 0 22.4 9.6 22.4 22.4s-9.6 22.4-22.4 22.4zM640 776H304c-12.8 0-22.4-9.6-22.4-22.4s9.6-22.4 22.4-22.4h336c12.8 0 22.4 9.6 22.4 22.4s-9.6 22.4-22.4 22.4zM155.2 321.6c-19.2 0-36.8-6.4-51.2-17.6-35.2-28.8-40-80-12.8-115.2 14.4-17.6 33.6-27.2 54.4-30.4 22.4-1.6 43.2 3.2 59.2 17.6 35.2 28.8 40 80 12.8 115.2-14.4 17.6-33.6 27.2-54.4 30.4h-8z m0-118.4h-4.8c-9.6 1.6-19.2 6.4-24 12.8-12.8 16-9.6 38.4 4.8 51.2 8 6.4 17.6 9.6 27.2 8 9.6-1.6 19.2-6.4 24-12.8 12.8-16 9.6-38.4-4.8-51.2-6.4-4.8-14.4-8-22.4-8zM155.2 833.6c-19.2 0-36.8-6.4-51.2-17.6-17.6-14.4-27.2-33.6-30.4-54.4-1.6-22.4 3.2-43.2 17.6-59.2 28.8-35.2 80-40 115.2-12.8 35.2 28.8 40 80 12.8 115.2-14.4 17.6-33.6 27.2-54.4 30.4-3.2-1.6-6.4-1.6-9.6-1.6z m0-118.4c-11.2 0-20.8 4.8-28.8 14.4-6.4 8-9.6 17.6-8 27.2 1.6 9.6 6.4 19.2 12.8 24s17.6 9.6 27.2 8c9.6-1.6 19.2-6.4 24-12.8 12.8-16 9.6-38.4-4.8-51.2-6.4-8-14.4-9.6-22.4-9.6zM155.2 577.6c-19.2 0-36.8-6.4-51.2-17.6-17.6-14.4-27.2-33.6-30.4-54.4-1.6-22.4 3.2-43.2 17.6-59.2 14.4-17.6 33.6-27.2 54.4-30.4 22.4-1.6 43.2 3.2 59.2 17.6 35.2 28.8 40 80 12.8 115.2-14.4 17.6-33.6 27.2-54.4 30.4-1.6-1.6-4.8-1.6-8-1.6z m0-118.4h-4.8c-9.6 1.6-19.2 6.4-24 12.8-6.4 8-9.6 17.6-8 27.2 1.6 9.6 6.4 19.2 12.8 24 8 6.4 17.6 9.6 27.2 8 9.6-1.6 19.2-6.4 24-12.8 12.8-16 9.6-38.4-4.8-51.2-6.4-4.8-14.4-8-22.4-8z" fill="#103E26"></path>
            </svg>
        </a>
    </div>
</div>
<div class="footer">
    <div class="footer-container">
        <p><a href="http://beian.miit.gov.cn">蜀ICP备18023259号-1</a></p>
        <p>Copyright © 2019 www.lrowy.com All Rights Reserved</p>
    </div>
</div>
<div class="oauth-container" id="oauth" style="display:none;">
    <a class="oauth" th:href="${'/login?url=/article/' + article.articleId}"><img th:src="@{/images/email.png}" alt="email">邮箱</a>
    <a class="oauth" th:href="${'https://github.com/login/oauth/authorize?client_id=' + clientId + '&scope=user:email&redirect_uri=http://localhost/oauth&state=/article/' + article.articleId}"><img th:src="@{/images/github.png}" alt="github" style="transform:scale(.83) translateY(-2px);">Github</a>
</div>
<link rel="stylesheet" th:href="@{/css/content-styles.css}">
<script>hljs.initHighlightingOnLoad();</script>
<script src="https://cdn.bootcss.com/jquery/3.4.0/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/fastclick/1.0.6/fastclick.js"></script>
<script src="https://cdn.bootcss.com/lodash.js/4.17.15/lodash.min.js"></script>
<script>document.addEventListener('DOMContentLoaded', function () { FastClick.attach(document.body); }, false);</script>
<script th:src="@{/js/tool.js}"></script>
<script th:src="@{/js/md-ripple.js}"></script>
<script th:src="@{/js/common-v2.js}"></script>
<script th:src="@{/js/ckeditor.js}"></script>
<script>
    function setDirectory(bash) {
        var str = '',
            num = 0,
            minLevel = 7;
        $('.article :header').each(function () {
            var $this = $(this),
                contentH = $this.text().replace(/\s*/g, '');
            contentH = contentH.replace(/\./g, '-');
            contentH = contentH.replace(/\(/g, '');
            contentH = contentH.replace(/\)/g, '');
            var level = $this[0].tagName.substr(1,1),
                hID = num + '-' + contentH;
            $this.attr('id', hID);
            hID = '##' + hID;

            num += 1;
            str += '<li><div class="item level' + level + '"><a href="' + hID + '">' + contentH + '</a></div></li>';
            if (level < minLevel) minLevel = level;
        });
        str = '<div class="h1">目录</div><div class="dir-body"><div class="cursor"></div><ul>' + str + '</ul></div>';
        if (num > 0) {
            $('.directory').html(str);
            $('.directory ul').css('margin-left', -(minLevel - 1) * 15 + 'px');
            $('.directory .item').mdRipple();
            $('.directory').show();
            setAnchor();
            initCursor(bash);
        }
    }

    function pageTo(href) {
        var target,
            pattern = /##.+/;
        var limit = Math.round($(document).height() - $(window).height());
        if (href === '#') {
            target = 0;
        } else if (href === '##') {
            target = limit;
        } else if (pattern.test(href)) {
            var len = href.length, hash = href.lastIndexOf("#");
            var id = href.substr(hash, len - hash);
            var ele = $(id);
            if (ele.length === 0) return;
            target = ele.offset().top - 60;
            if (target > limit) target = limit;
        } else {
            return;
        }
        $(window).unbind('scroll');
        $('html').stop().animate({scrollTop: target}, 600, 'swing', function () {}).promise().then(function () {
            $(window).scroll(_.throttle(scrollEvent, 300));
        });
    }

    function setAnchor() {
        var a = $('a[href*="#"]');
        a.off('mousedown touchstart');
        a.on('mousedown touchstart', function () {
            var $this = $(this),
                href = $this.attr('href'),
                index = $this.parents('li').prevAll().length;
            setCursor(index);
            $this.on('mouseup mouseleave touchend', function () {
                pageTo(href);
                window.location.hash = href;
                $this.off('mouseup mouseleave touchend');
            });
        });
    }

    function setCursor(index) {
        var dir = $('.directory:visible'),
            top = 0,
            li = dir.find('ul').children().eq(index);
        if (index === -1) {
            dir.find('.cursor').css({'top': 0, 'height': 0, 'border': 'none'});
            dir.find('li').removeClass('active');
        } else if (index === -2) {
            dir.find('.cursor').css({'top': $('.dir-body:visible').height(), 'height': 0, 'border': 'none'});
            dir.find('li').removeClass('active');
        } else {
            li.prevAll().each(function () {top += $(this).height();});
            dir.find('.cursor').css({'top': top, 'height': li.height(), 'border': ''});
            dir.find('li').removeClass('active');
            li.addClass('active');
        }
    }

    function initCursor(href) {
        $('a[href*="#"]').each(function () {
            var $this = $(this), ref = $this.attr('href');
            if (ref === href) {
                var index = $this.parents('li').prevAll().length;
                setCursor(index);
            }
        });
    }

    function scrollEvent() {
        var scrollTop = $(this).scrollTop();

        if (scrollTop === 0) window.location.hash = '';

        if (scrollTop > $('.footer').offset().top - $(window).height() || scrollTop > $('.comment-container').offset().top - 60) {
            $('.header').addClass('hide');
            $('.sidebar').addClass('full');
        } else {
            $('.header').removeClass('hide');
            $('.sidebar').removeClass('full');
        }

        var $header = $('.article :header'), bottom = $('#article').offset().top + $('#article').outerHeight(), index =  -1;
        for (var i = 0;i < $header.length;i++) {
            if (scrollTop + 61 >= $($header[i]).offset().top) {
                if (i === ($header.length - 1) && scrollTop + 61 >= bottom) {
                    index = -2;
                } else {
                    index++;
                }
            } else {
                if (i === 0) {
                    break;
                }
            }
        }
        if (index > 0) {
            initCursor('##' + $header[index].getAttribute('id'));
        } else {
            setCursor(index);
        }
    }

    function copyLink(ele) {
        var id = $(ele).data('articleId');
        navigator.clipboard.writeText(window.location.host + '/article/' + id).then(function () {
            message.open({ content: '复制成功！' });
        }).catch(function () {
            message.open({ content: '浏览器不支持！' });
        });
    }

    function setImages() {
        var image = $('.article figure img'),
            array = [];
        image.each(function (index) {
            $(this).data('index', index);
            array.push($(this).attr('src'));
        });
        image.click(function () {
            preview.init(array, $(this).data('index'));
        });
    }

    function setArticle(id, html) {
        var $article = $('#article'),
            $wrapper = $('.article_wrapper');
        if (id === $article.data('articleId')) {
            $wrapper.height($article.height());
            $('#article').html(html);
            hljs.highlightBlock($article[0]);
            setImages();
            setDirectory();
            $wrapper.height($article.height());
            pageTo('##');
        }
    }

    function loginTip() {
        modal.open({title:'请登录', content:$('#oauth')});
    }

    function submitComment() {
        var content = editor.getData();
        if (content === '') {
            message.fail({ content: '内容不应为空' });
        } else {
            $.ajax({
                url: '/comment/add',
                type: 'post',
                data: {
                    issueId: $('#article').data('articleId'),
                    content: content
                },
                success: function (data) {
                    if (data.code === '000') {
                        window.location.reload();
                    } else if (data.code === '103') {
                        loginTip();
                    }
                }
            });
        }
    }

    function submitReply(e) {
        var $editor = $(e).prev(),
            id = $editor.data('commentId'),
            editor = CKEDITOR.instances[$editor.attr('id')],
            content = editor.getData();
        if (content === '') {
            message.fail({ content: '内容不应为空' });
        } else {
            $.ajax({
                url: '/comment/add',
                type: 'post',
                data: {
                    pId: id,
                    issueId: $('#article').data('articleId'),
                    content: content
                },
                success: function (data) {
                    if (data.code === '000') {
                        window.location.reload();
                    } else if (data.code === '103') {
                        loginTip();
                    }
                }
            });
        }
    }

    function initInlineEditor(id, placeholder, success) {
        config.placeholder = placeholder;
        CKEDITOR.InlineEditor
            .create(document.querySelector('#' + id), config)
            .then(editor => {
                var $editor = $(editor.sourceElement);
                CKEDITOR.instances[id] = editor;
                editor.editing.view.document.on('change:isFocused', (evt,name,value) => {
                    if (value) {
                        var $comment = $('#' + $editor.data('commentId')), $nick = $comment.children().eq(1);
                        $('.comment-at').remove();
                        $nick.prepend('<span class="comment-at custom-font1">@ </span>');
                    }
                });
                success(editor, id);
            })
            .catch(error => {
                console.log(error);
            });
    }

    function initClassicEditor() {
        var config = CKEDITOR.ClassicEditor.simpleConfig;
        config.simpleUpload = { uploadUrl: 'http://localhost/comment/uploadImage' };
        CKEDITOR.ClassicEditor.create(document.querySelector('#editor'), config)
            .then(editor => {
                window.editor = editor;
            })
            .catch(error => {
                console.log(error);
            });
    }

    function setComment(e) {
        var $comment = $(e).parent().parent(),
            $parent = $comment.parent(),
            editor,
            editorId,
            $editor,
            name = $comment.children().eq(1).find('.owner').text(),
            commentId = $comment.attr('id');

        var focus = function (editor, editorId) {
            editor.editing.view.focus();
            $comment.addClass('twinkle');
            setTimeout(function () {
                $comment.removeClass('twinkle');
                window.location.href = '#' + editorId;
            }, 600);
        };

        if ($parent.hasClass('comment-reply')) {
            $editor = $parent.find('.comment-reply-editor');
            if ($editor.length > 0) {
                editorId = $editor.attr('id');
                $editor.data('commentId', commentId);
                editor = CKEDITOR.instances[editorId];
                editor.changePlaceholder('回复' + name);
                focus(editor, editorId);
            } else {
                editorId = 'reply-editor' + $comment.attr('id');
                $parent.append('<div class="comment-reply-content"><div id="' + editorId + '" class="comment-reply-editor" contenteditable="true" data-comment-id="' + commentId + '"></div><div class="comment-submit-btn" onclick="submitReply(this)">发表</div></div>');
                initInlineEditor(editorId, '回复' + name, focus);
            }
        } else if ($parent.hasClass('comment-list')) {
            $editor = $comment.find('.comment-reply-editor');
            if ($editor.length > 0) {
                editorId = $editor.attr('id');
                $editor.data('commentId', commentId);
                editor = CKEDITOR.instances[editorId];
                editor.changePlaceholder('回复' + name);
                focus(editor, editorId);
            } else {
                editorId = 'reply-editor' + $comment.attr('id');
                var $reply = $comment.find('.comment-reply');
                if ($reply.length > 0) {
                    $reply.append('<div class="comment-reply-content"><div id="' + editorId + '" class="comment-reply-editor" contenteditable="true" data-comment-id="' + commentId + '"></div><div class="comment-submit-btn" onclick="submitReply(this)">发表</div></div>');
                } else {
                    $comment.append('<div class="comment-reply"><div class="comment-reply-content"><div id="' + editorId + '" class="comment-reply-editor" contenteditable="true" data-comment-id="' + commentId + '"></div><div class="comment-submit-btn" onclick="submitReply(this)">发表</div></div></div>');
                }
                initInlineEditor(editorId, '回复' + name, focus);
            }
        }
    }

    $(window).scroll(_.throttle(scrollEvent, 300));
    $(document).ready(function () {
        var bash = decodeURIComponent(window.location.hash);
        CKEDITOR.instances = {};
        commom.setMenuButton({ menuClass: 'menu', menuActiveClass: 'menu-active'});
        setImages();
        setDirectory(bash);
        pageTo(bash);
        initClassicEditor();
    });
</script>
</body>
</html>