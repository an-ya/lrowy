<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lrowy.dao.BookmarkDao">
    <resultMap id="bookmark" type="com.lrowy.pojo.bookmark.Bookmark">
        <id column="bookmarkId" property="bookmarkId"/>
        <result column="bookmarkCategoryId" property="bookmarkCategoryId"/>
        <result column="description" property="description"/>
        <result column="title" property="title"/>
        <result column="state" property="state"/>
        <result column="url" property="url"/>
        <result column="baseUrl" property="baseUrl"/>
        <result column="visits" property="visits"/>
        <result column="delFlag" property="delFlag"/>
        <result column="hiddenFlag" property="hiddenFlag"/>
        <result column="isAccessible" property="isAccessible"/>
        <result column="shortcutFlag" property="shortcutFlag"/>
        <result column="createDate" property="createDate"/>
        <association property="favicon" javaType="com.lrowy.pojo.bookmark.Favicon">
            <id column="faviconId" property="faviconId"/>
            <result column="domain" property="domain"/>
            <result column="topDomain" property="topDomain"/>
            <result column="faviconUrl" property="faviconUrl"/>
            <result column="faviconBlurUrl" property="faviconBlurUrl"/>
            <result column="faviconOriginalUrl" property="faviconOriginalUrl"/>
        </association>
    </resultMap>

    <insert id="saveBookmark" parameterType="com.lrowy.pojo.bookmark.Bookmark">
        <selectKey keyProperty="bookmarkId" order="AFTER" resultType="java.lang.Integer">
            SELECT LAST_INSERT_ID()
        </selectKey>
        INSERT INTO bookmark (bookmarkCategoryId,description,title,state,url,baseUrl,visits,delFlag,hiddenFlag,isAccessible,shortcutFlag,createDate) VALUE (#{bookmarkCategoryId},#{description},#{title},#{state},#{url},#{baseUrl},#{visits},#{delFlag},#{hiddenFlag},#{isAccessible},#{shortcutFlag},#{createDate});
    </insert>

    <select id="findShortcut" resultMap="bookmark">
        SELECT *
        FROM bookmark
        JOIN bookmark_favicon ON bookmark.bookmarkId = bookmark_favicon.bookmarkId
        JOIN favicon ON favicon.faviconId = bookmark_favicon.faviconId
        WHERE shortcutFlag = 1
        ORDER BY bookmark.bookmarkCategoryId;
    </select>

    <select id="findBookmark" resultMap="bookmark">
        SELECT *
        FROM bookmark
        JOIN bookmark_favicon ON bookmark.bookmarkId = bookmark_favicon.bookmarkId
        JOIN favicon ON favicon.faviconId = bookmark_favicon.faviconId
        WHERE shortcutFlag = 0
        ORDER BY bookmark.bookmarkCategoryId;
    </select>

    <insert id="saveFavicon" parameterType="com.lrowy.pojo.bookmark.Favicon">
        <selectKey keyProperty="faviconId" order="AFTER" resultType="java.lang.Integer">
            SELECT LAST_INSERT_ID()
        </selectKey>
        INSERT INTO favicon (domain,topDomain,faviconUrl,faviconBlurUrl,faviconOriginalUrl) VALUE (#{domain},#{topDomain},#{faviconUrl},#{faviconBlurUrl},#{faviconOriginalUrl});
    </insert>

    <insert id="saveBookmarkFavicon" parameterType="com.lrowy.pojo.bookmark.Bookmark">
        INSERT INTO bookmark_favicon (bookmarkId,faviconId) VALUE (#{bookmarkId},#{favicon.faviconId});
    </insert>
</mapper>